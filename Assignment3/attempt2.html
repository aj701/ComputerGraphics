
<!-- saved from url=(0048)http://ajlevine.com/compg/code2/index-trans.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"></head><body><div class="line-gutter-backdrop"></div><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>=<a class="html-attribute-value html-resource-link" target="_blank" href="http://ajlevine.com/compg/code2/lib1.js">lib1.js</a>&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;body <span class="html-attribute-name">bgcolor</span>=<span class="html-attribute-value">black</span>&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content"><span class="html-tag">&lt;center&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content"><span class="html-tag">&lt;td&gt;</span><span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>='<span class="html-attribute-value">canvas1</span>' <span class="html-attribute-name">width</span>=<span class="html-attribute-value">600</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">600</span>&gt;</span><span class="html-tag">&lt;/canvas&gt;</span><span class="html-tag">&lt;/td&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content"><span class="html-tag">&lt;/center&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="8"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="9"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">id</span>='<span class="html-attribute-value">my_vertex_shader</span>' <span class="html-attribute-name">type</span>='<span class="html-attribute-value">x-shader/x-vertex</span>'&gt;</span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content">   attribute vec3 aPosition;</td></tr><tr><td class="line-number" value="11"></td><td class="line-content">   varying   vec3 vPosition;</td></tr><tr><td class="line-number" value="12"></td><td class="line-content">   void main() {</td></tr><tr><td class="line-number" value="13"></td><td class="line-content">      gl_Position = vec4(aPosition, 1.0);</td></tr><tr><td class="line-number" value="14"></td><td class="line-content">      vPosition = aPosition;</td></tr><tr><td class="line-number" value="15"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="16"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="17"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="18"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">id</span>='<span class="html-attribute-value">my_fragment_shader</span>' <span class="html-attribute-name">type</span>='<span class="html-attribute-value">x-shader/x-fragment</span>'&gt;</span></td></tr><tr><td class="line-number" value="19"></td><td class="line-content">   precision mediump float;</td></tr><tr><td class="line-number" value="20"></td><td class="line-content">   uniform float uTime; // my clock</td></tr><tr><td class="line-number" value="21"></td><td class="line-content">   uniform vec3  uCursor; //my cursor position</td></tr><tr><td class="line-number" value="22"></td><td class="line-content">   varying vec3  vPosition;</td></tr><tr><td class="line-number" value="23"></td><td class="line-content">   vec4 sphere; //make spheres</td></tr><tr><td class="line-number" value="24"></td><td class="line-content">   vec3 material; //my rgb material</td></tr><tr><td class="line-number" value="25"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="26"></td><td class="line-content">   vec3 Lrgb; // my color of light</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">   vec3 Ldir; // my light direction</td></tr><tr><td class="line-number" value="28"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="29"></td><td class="line-content">//noise code from class</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">vec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">float noise(vec3 P) {</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">   vec3 i0 = mod289(floor(P)), i1 = mod289(i0 + vec3(1.0));</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">   vec3 f0 = fract(P), f1 = f0 - vec3(1.0), f = fade(f0);</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">   vec4 ix = vec4(i0.x, i1.x, i0.x, i1.x), iy = vec4(i0.yy, i1.yy);</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">   vec4 iz0 = i0.zzzz, iz1 = i1.zzzz;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">   vec4 ixy = permute(permute(ix) + iy), ixy0 = permute(ixy + iz0), ixy1 = permute(ixy + iz1);</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">   vec4 gx0 = ixy0 * (1.0 / 7.0), gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">   vec4 gx1 = ixy1 * (1.0 / 7.0), gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">   gx0 = fract(gx0); gx1 = fract(gx1);</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">   vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0), sz0 = step(gz0, vec4(0.0));</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">   vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1), sz1 = step(gz1, vec4(0.0));</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">   gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">   gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">   vec3 g0 = vec3(gx0.x,gy0.x,gz0.x), g1 = vec3(gx0.y,gy0.y,gz0.y),</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">        g2 = vec3(gx0.z,gy0.z,gz0.z), g3 = vec3(gx0.w,gy0.w,gz0.w),</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">        g4 = vec3(gx1.x,gy1.x,gz1.x), g5 = vec3(gx1.y,gy1.y,gz1.y),</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">        g6 = vec3(gx1.z,gy1.z,gz1.z), g7 = vec3(gx1.w,gy1.w,gz1.w);</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">   vec4 norm0 = taylorInvSqrt(vec4(dot(g0,g0), dot(g2,g2), dot(g1,g1), dot(g3,g3)));</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">   vec4 norm1 = taylorInvSqrt(vec4(dot(g4,g4), dot(g6,g6), dot(g5,g5), dot(g7,g7)));</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">   g0 *= norm0.x; g2 *= norm0.y; g1 *= norm0.z; g3 *= norm0.w;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">   g4 *= norm1.x; g6 *= norm1.y; g5 *= norm1.z; g7 *= norm1.w;</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">   vec4 nz = mix(vec4(dot(g0, vec3(f0.x, f0.y, f0.z)), dot(g1, vec3(f1.x, f0.y, f0.z)),</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">                      dot(g2, vec3(f0.x, f1.y, f0.z)), dot(g3, vec3(f1.x, f1.y, f0.z))),</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">                 vec4(dot(g4, vec3(f0.x, f0.y, f1.z)), dot(g5, vec3(f1.x, f0.y, f1.z)),</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">                      dot(g6, vec3(f0.x, f1.y, f1.z)), dot(g7, vec3(f1.x, f1.y, f1.z))), f.z);</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">   return 2.2 * mix(mix(nz.x,nz.z,f.y), mix(nz.y,nz.w,f.y), f.x);</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">float noise(vec2 P) { return noise(vec3(P, 0.0)); }</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">float fractal(vec3 P) {</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">   float f = 0., s = 1.;</td></tr><tr><td class="line-number" value="65"></td><td class="line-content">   for (int i = 0 ; i &lt; 9 ; i++) {</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">      f += noise(s * P) / s;</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">      s *= 2.;</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">      P = vec3(.866 * P.x + .5 * P.z, P.y + 100., -.5 * P.x + .866 * P.z);</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">   return f;</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">float turbulence(vec3 P) {</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">   float f = 0., s = 1.;</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">   for (int i = 0 ; i &lt; 9 ; i++) {</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">      f += abs(noise(s * P)) / s;</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">      s *= 2.;</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">      P = vec3(.866 * P.x + .5 * P.z, P.y + 100., -.5 * P.x + .866 * P.z);</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">   return f;</td></tr><tr><td class="line-number" value="80"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">//end of noise from professor</td></tr><tr><td class="line-number" value="82"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="83"></td><td class="line-content">   // Compute intersection of a ray with a sphere, if any.  Return t.</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">   // If there is no intersection, return 10000.</td></tr><tr><td class="line-number" value="85"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="86"></td><td class="line-content">   float raySphere(vec3 V, vec3 W, vec4 sph) {</td></tr><tr><td class="line-number" value="87"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="88"></td><td class="line-content">      //YOU NEED TO COMPUTE t, BY SETTING UP AND THEN SOLVING A QUADRATIC EQUATION.</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">      vec3 D = V - sph.xyz; // computing t quadratic equation</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">      float c = dot(D, D) - (sph.w * sph.w);</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">      float b = dot(W, D);</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">      float d = b * b - c;</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">      float t = -b - sqrt(d);</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">         return t; </td></tr><tr><td class="line-number" value="95"></td><td class="line-content"> </td></tr><tr><td class="line-number" value="96"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">   // Diffusely shade a sphere.</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">   //    point is the x,y,z position of the surface point.</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">   //    sphere is the x,y,z,r definition of the sphere.</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">   //    material is the r,g,b color of the sphere.</td></tr><tr><td class="line-number" value="101"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="102"></td><td class="line-content">   vec3 shadeSphere(vec3 point, vec4 sphere, vec3 material) {</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="104"></td><td class="line-content">      // myTurb - point: larger= smaller noise and opposite</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">      // - uTime - speed... increase get nice water effect</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">      float myTurb = turbulence(cos(point/0.85) + sin(uTime/15.) * -50. + noise(sin(point + uTime)));</td></tr><tr><td class="line-number" value="107"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="108"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="109"></td><td class="line-content">      vec3 ambient = material / 3.;</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">      vec3 diffuse = vec3(myTurb, 0.0, 0.0); // only red value affecting</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">      vec3 normal = (point - sphere.xyz) / sphere.w;</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">      vec3 color = ambient + Lrgb*diffuse*max(0.2,dot(Ldir, normal)); //new color - first number in max affecting opacity</td></tr><tr><td class="line-number" value="113"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="114"></td><td class="line-content">      // YOU NEED TO COMPUTE COLOR FOR A DIFFUSELY SHADED SPHERE.</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">      // FOR THE AMBIENT COMPONENT OF THE DIFFUSE SHADING, YOU CAN</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">      // USE A SIMPLE APPROXIMATION SUCH AS: ambient = material / 5.;</td></tr><tr><td class="line-number" value="117"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="118"></td><td class="line-content">      return color;</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="120"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="121"></td><td class="line-content">   void main(void) {</td></tr><tr><td class="line-number" value="122"></td><td class="line-content">      vec2 c = uCursor.xy;</td></tr><tr><td class="line-number" value="123"></td><td class="line-content">      // float x = vPosition.x;</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">      // float y = vPosition.y;</td></tr><tr><td class="line-number" value="125"></td><td class="line-content">      // float z = vPosition.z;</td></tr><tr><td class="line-number" value="126"></td><td class="line-content">      Lrgb = vec3(1.0, 0.0, 0.0); //light color - why does only red react?</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">      //Ldir = normalize(vec3(c.x, c.y, 1. - 2. * dot(c, c))); // light direction</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">      Ldir = normalize(vec3(sin(uTime), 0.001*sin(uTime), cos(uTime)));</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">      // float s = 0.0; //aj</td></tr><tr><td class="line-number" value="130"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="131"></td><td class="line-content">      // YOU NEED TO COMPUTE V AND W TO CREATE THE RAY FOR THIS PIXEL,</td></tr><tr><td class="line-number" value="132"></td><td class="line-content">      // USING vPosition.x AND vPosition.y.</td></tr><tr><td class="line-number" value="133"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="134"></td><td class="line-content">      vec3 V, W;</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">      V = vec3(0., 0., 1.); //aj</td></tr><tr><td class="line-number" value="136"></td><td class="line-content">      //W = vec3(vPosition.x, vPosition.y, -5.); //aj</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">      W = normalize(vec3(vPosition.x, vPosition.y, -V.z)); // not sure?</td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">      // YOU NEED TO SET x,y,z AND r FOR sphere.</td></tr><tr><td class="line-number" value="140"></td><td class="line-content">      sphere = vec4(0., 0., -10., 7.); //aj</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">      // sphere1 = vec4(0.,0., -5. 3.);</td></tr><tr><td class="line-number" value="142"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="143"></td><td class="line-content">      // YOU NEED TO SET r,g,b FOR material.</td></tr><tr><td class="line-number" value="144"></td><td class="line-content">      material = vec3(0.4, 0.4, 0.6); //aj</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">      vec3 color = vec3(0., 0., 0.);</td></tr><tr><td class="line-number" value="146"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="147"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="148"></td><td class="line-content">      float t = raySphere(V, W, sphere);</td></tr><tr><td class="line-number" value="149"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="150"></td><td class="line-content">      if (t &gt; 0.) {</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">         // material = vec3(0.75, 0.5, 1.0);</td></tr><tr><td class="line-number" value="152"></td><td class="line-content">         color = shadeSphere(V + t * W, sphere, material);</td></tr><tr><td class="line-number" value="153"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">       //color.r = 0.2; // We added this line in class. - removing background</td></tr><tr><td class="line-number" value="155"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="156"></td><td class="line-content">      color = pow(color, vec3(.45,.45,.45)); // Do Gamma correction.</td></tr><tr><td class="line-number" value="157"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="158"></td><td class="line-content">      gl_FragColor = vec4(color, 1.);        // Set opacity to 1.</td></tr><tr><td class="line-number" value="159"></td><td class="line-content">   }</td></tr><tr><td class="line-number" value="160"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="161"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="162"></td><td class="line-content"><span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="163"></td><td class="line-content">start_gl('canvas1', document.getElementById('my_vertex_shader'  ).innerHTML,</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">                    document.getElementById('my_fragment_shader').innerHTML);</td></tr><tr><td class="line-number" value="165"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="166"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="167"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>